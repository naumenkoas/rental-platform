<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center">
  <div class="max-w-md w-full bg-white shadow-xl rounded-2xl p-8 space-y-6">
    <h2 class="text-2xl font-bold text-slate-800 text-center">Create account</h2>

    <div class="space-y-3">
      <input id="email" type="email" placeholder="Email"
        class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500" />
      <input id="password" type="password" placeholder="Password"
        class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500" />

      <div class="space-y-1">
        <label class="block text-sm font-medium text-slate-700">I am</label>
        <select id="role"
          class="w-full px-3 py-2 border rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
          <option value="tenant">Tenant (I want to rent)</option>
          <option value="landlord">Landlord (I offer properties)</option>
        </select>
      </div>
    </div>

    <button id="registerBtn"
      class="w-full px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 transition">
      Sign up
    </button>

    <p class="text-sm text-center text-slate-600">
      Already have an account?
      <a href="login.html" class="text-emerald-600 hover:underline">Log in</a>
    </p>

    <p id="msg" class="text-sm text-center text-red-600"></p>
  </div>

<script>
document.getElementById("registerBtn").addEventListener("click", register);

async function register() {
  const email = document.getElementById("email").value.trim();
  const pass = document.getElementById("password").value.trim();
  const role = document.getElementById("role").value;
  const msg = document.getElementById("msg");
  msg.textContent = "";

  if (!email || !pass) {
    msg.textContent = "Email and password are required.";
    return;
  }

  const { data, error } = await supabase.auth.signUp({
    email: email,
    password: pass
  });

  if (error) {
    msg.textContent = error.message;
    return;
  }

  const userId = data.user.id;

  const { error: profError } = await supabase
    .from("profiles")
    .insert([{ user_id: userId, role, created_at: new Date().toISOString() }]);

  if (profError) {
    msg.textContent = profError.message;
    return;
  }

  msg.classList.remove("text-red-600");
  msg.classList.add("text-emerald-600");
  msg.textContent = "Registration successful. Check your email (if confirmation is enabled) and then log in.";
  setTimeout(() => window.location.href = "login.html", 1500);
}
</script>
</body>
</html>
