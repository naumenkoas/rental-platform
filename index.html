<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sign in</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-md bg-white rounded-2xl shadow p-8">
    <h1 class="text-2xl font-bold text-slate-800 mb-4 text-center">Sign in</h1>

    <p id="status" class="text-sm text-slate-600 mb-3"></p>

    <form id="loginForm" class="space-y-3 hidden">
      <input id="email" type="email" placeholder="Email"
        class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500" required />

      <input id="password" type="password" placeholder="Password"
        class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500" required />

      <button type="submit"
        class="w-full px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 transition">
        Sign in
      </button>
    </form>

    <p class="text-xs text-slate-600 mt-4 text-center">
      No account?
      <a href="register.html"
         class="text-emerald-700 font-semibold hover:underline">
        Sign up
      </a>
    </p>
  </div>

<script>
const supabaseUrl = "https://zzkriumjamchjrxdxhzf.supabase.co";
const supabaseKey =
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp6a3JpdW1qYW1jaGpyeGR4aHpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNDkyNDcsImV4cCI6MjA3OTgyNTI0N30.mK7jN6En9SWhr2Avt545CIGm58Kd7ACgs8hGOe4UKMU";

const supabase = window.supabase.createClient(
  supabaseUrl,
  supabaseKey
);

const statusEl = document.getElementById("status");
const formEl   = document.getElementById("loginForm");

function setStatus(text, isError=false){
  statusEl.textContent = text || "";
  statusEl.className =
    "text-sm mb-3 " + (isError ? "text-red-600" : "text-slate-600");
}

/*** ✅ Проверка существующей сессии при загрузке ***/
window.addEventListener("load", checkExistingSession);

async function checkExistingSession(){
  setStatus("Checking session...");
  const { data, error } = await supabase.auth.getUser();

  // Сессии нет → показываем форму
  if (error || !data || !data.user) {
    formEl.classList.remove("hidden");
    setStatus("");
    return;
  }

  // Сессия есть → редирект сразу
  redirect
